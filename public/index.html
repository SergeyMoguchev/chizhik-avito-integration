<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∏–∂–∏–∫ - –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –Ω–∞ –ø—Ä–æ–¥–∞–∂—É –Ω–∞ –ê–≤–∏—Ç–æ</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=a02e9c35-dadf-4b17-903a-4893c30c8b3e&lang=ru_RU" type="text/javascript"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 50%, #6ba368 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2d5016, #4a7c59, #6ba368);
        }
        .header {
            text-align: center;
            color: #2d5016;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
        }
        .header h1 {
            font-size: 2.8em;
            margin: 0;
            background: linear-gradient(45deg, #2d5016, #4a7c59, #6ba368);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }
        .header p {
            color: #666;
            font-size: 1.1em;
            margin-top: 10px;
        }
        .status {
            padding: 18px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid;
            font-weight: 500;
        }
        .success { 
            background-color: #d4edda; 
            color: #155724; 
            border-left-color: #28a745;
        }
        .info { 
            background-color: #d1ecf1; 
            color: #0c5460; 
            border-left-color: #17a2b8;
        }
        .warning { 
            background-color: #fff3cd; 
            color: #856404; 
            border-left-color: #ffc107;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            background: linear-gradient(45deg, #2d5016, #4a7c59);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px 5px;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(45, 80, 22, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        button:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(45, 80, 22, 0.4);
            background: linear-gradient(45deg, #4a7c59, #6ba368);
        }
        button:active {
            transform: translateY(-1px);
        }
        button.primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
        }
        button.primary:hover {
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
            background: linear-gradient(45deg, #0056b3, #004085);
        }

        /* –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ß–∏–∂–∏–∫ */
        .chizhik-requirements {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 2px solid #2d5016;
            position: relative;
        }
        .chizhik-requirements h3 {
            color: #2d5016;
            margin-top: 0;
            font-size: 1.3em;
            display: flex;
            align-items: center;
        }
        .chizhik-requirements ul {
            columns: 2;
            column-gap: 30px;
            list-style: none;
            padding: 0;
        }
        .chizhik-requirements li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
            break-inside: avoid;
        }
        .chizhik-requirements li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        /* –°—Ç–∞—Ç—É—Å API */
        .api-status {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #4a7c59;
        }
        .api-key-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }
        .api-key-item:last-child {
            border-bottom: none;
        }
        .api-key-name {
            font-weight: 600;
            color: #2d5016;
        }
        .api-key-value {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #666;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ –∏ –∫–∞—Ä—Ç–∞ */
        .search-and-map {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .search-form {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #dee2e6;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .search-form h3 {
            color: #2d5016;
            margin-top: 0;
            font-size: 1.4em;
        }
        .form-group {
            margin: 20px 0;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 14px;
        }
        .form-group select, .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ced4da;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #2d5016;
            box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.1);
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .form-group.full-width {
            grid-column: 1 / -1;
        }

        /* –ö–∞—Ä—Ç–∞ */
        .map-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #dee2e6;
        }
        .map-container h3 {
            color: #2d5016;
            margin-top: 0;
            text-align: center;
        }
        #yandex-map {
            width: 100%;
            height: 400px;
            border-radius: 10px;
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        #results {
            margin-top: 25px;
            padding: 25px;
            border-radius: 15px;
            max-height: 600px;
            overflow-y: auto;
        }
        .result-item {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            border-left: 5px solid #2d5016;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .result-title {
            font-weight: 700;
            color: #2d5016;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .result-details {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.6;
        }
        .result-price {
            font-weight: bold;
            color: #28a745;
            font-size: 18px;
            margin: 8px 0;
        }
        .result-link {
            display: inline-block;
            margin-top: 12px;
            padding: 8px 16px;
            background: linear-gradient(45deg, #2d5016, #4a7c59);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .result-link:hover {
            background: linear-gradient(45deg, #4a7c59, #6ba368);
            transform: translateY(-1px);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 968px) {
            .search-and-map {
                grid-template-columns: 1fr;
            }
            .chizhik-requirements ul {
                columns: 1;
            }
            .container {
                padding: 25px;
                margin: 10px;
            }
            .header h1 {
                font-size: 2.2em;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ –ß–∏–∂–∏–∫ - –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –Ω–∞ –ø—Ä–æ–¥–∞–∂—É</h1>
            <p>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ê–≤–∏—Ç–æ API –∏ –∫–∞—Ä—Ç–∞–º–∏ –Ø–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</p>
        </div>

        <div class="status success">
            <strong>‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞ —Å –Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–∞–º–∏!</strong><br>
            –í–µ—Ä—Å–∏—è: 5.2.0 | –°—Ç–∞—Ç—É—Å: API –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã | –†–µ–≥–∏–æ–Ω–æ–≤: 34 + –≤—Å–µ —Ä–µ–≥–∏–æ–Ω—ã | –¢–∏–ø: –ü—Ä–æ–¥–∞–∂–∞ –ø–æ–º–µ—â–µ–Ω–∏–π
        </div>

        <div class="api-status">
            <h3 style="text-align: center; margin-top: 0; color: #2d5016;">üîë –°—Ç–∞—Ç—É—Å API –Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç</h3>
            <div class="api-key-item">
                <span class="api-key-name">üó∫Ô∏è JavaScript API –∏ HTTP –ì–µ–æ–∫–æ–¥–µ—Ä:</span>
                <span class="api-key-value">a02e9c35-dadf-4b17-903a-4893c30c8b3e</span>
            </div>
            <div class="api-key-item">
                <span class="api-key-name">üß© Tiles API:</span>
                <span class="api-key-value">37d973f4-24d9-45f9-aef5-1745f7a13e1d</span>
            </div>
            <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: 600;">
                ‚úÖ –í—Å–µ API –∫–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
            </div>
        </div>

        <div class="chizhik-requirements">
            <h3>üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–µ—Ç–∏ "–ß–∏–∂–∏–∫" –∫ –ø–æ–º–µ—â–µ–Ω–∏—è–º:</h3>
            <ul>
                <li><strong>–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å:</strong> –æ—Ç 390 –∫–≤.–º (–≤–æ–∑–º–æ–∂–Ω–æ –±–æ–ª—å—à–µ)</li>
                <li><strong>–¢–æ—Ä–≥–æ–≤—ã–π –∑–∞–ª:</strong> 250-280 –∫–≤.–º</li>
                <li><strong>–¢–∏–ø —Å–¥–µ–ª–∫–∏:</strong> –ü–û–ö–£–ü–ö–ê –ø–æ–º–µ—â–µ–Ω–∏—è (–Ω–µ –∞—Ä–µ–Ω–¥–∞)</li>
                <li><strong>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ –≤ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ</li>
                <li><strong>–í—Ö–æ–¥:</strong> –Ω–∞–ª–∏—á–∏–µ –≤—Ö–æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã</li>
                <li><strong>–†–∞–∑–≥—Ä—É–∑–∫–∞:</strong> –∑–æ–Ω–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã–µ –ø—É—Ç–∏</li>
                <li><strong>–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ:</strong> 40-50 –∫–í—Ç</li>
                <li><strong>–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏:</strong> –≤–æ–¥–∞, –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è, –æ—Ç–æ–ø–ª–µ–Ω–∏–µ</li>
            </ul>
        </div>

        <h3>üîó API Endpoints:</h3>
        <ul>
            <li><strong>GET /api/health</strong> - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã</li>
            <li><strong>POST /api/auth</strong> - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ê–≤–∏—Ç–æ API</li>
            <li><strong>POST /api/search</strong> - –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –Ω–∞ –ø—Ä–æ–¥–∞–∂—É</li>
        </ul>

        <h3>üéõÔ∏è –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã:</h3>
        <button onclick="testHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Health</button>
        <button onclick="testAuth()" class="primary">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ê–≤–∏—Ç–æ</button>
        <button onclick="testMap()" style="background: linear-gradient(45deg, #28a745, #20c997);">–¢–µ—Å—Ç –∫–∞—Ä—Ç—ã</button>

        <div class="search-and-map">
            <div class="search-form">
                <h3>üîç –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –Ω–∞ –ø—Ä–æ–¥–∞–∂—É:</h3>

                <div class="form-group">
                    <label for="region">–†–µ–≥–∏–æ–Ω –ø–æ–∏—Å–∫–∞:</label>
                    <select id="region" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω...</option>
                        <option value="all_regions" style="background-color: #e8f5e8; font-weight: bold;">üåç –í–°–ï –†–ï–ì–ò–û–ù–´ –†–û–°–°–ò–ò</option>
                        <optgroup label="üèõÔ∏è –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è">
                            <option value="moscow">–ú–æ—Å–∫–≤–∞ –∏ –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="voronezh">–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="yaroslavl">–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="ivanovo">–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="vladimir">–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="tula">–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="tver">–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="ryazan">–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="kaluga">–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="belgorod">–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                        </optgroup>
                        <optgroup label="üåä –ü–æ–≤–æ–ª–∂—å–µ">
                            <option value="saratov">–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="nizhny_novgorod">–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="kazan">–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω</option>
                            <option value="samara">–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="volgograd">–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="ufa">–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω</option>
                            <option value="penza">–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="orenburg">–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                        </optgroup>
                        <optgroup label="‚õ∞Ô∏è –£—Ä–∞–ª">
                            <option value="chelyabinsk">–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="ekaterinburg">–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="perm">–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π</option>
                            <option value="kurgan">–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                        </optgroup>
                        <optgroup label="‚òÄÔ∏è –Æ–≥ –†–æ—Å—Å–∏–∏">
                            <option value="rostov">–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="krasnodar">–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π</option>
                            <option value="stavropol">–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π</option>
                            <option value="astrakhan">–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                        </optgroup>
                        <optgroup label="‚ùÑÔ∏è –°–∏–±–∏—Ä—å">
                            <option value="novosibirsk">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="kemerovo">–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="omsk">–û–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="tomsk">–¢–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                        </optgroup>
                        <optgroup label="üå≤ –°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥">
                            <option value="spb">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –∏ –õ–û</option>
                            <option value="kaliningrad">–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="arkhangelsk">–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                            <option value="murmansk">–ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</option>
                        </optgroup>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="minArea">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å (–∫–≤.–º):</label>
                        <input type="number" id="minArea" value="390" min="100" max="10000" required>
                        <small style="color: #666;">–°—Ç–∞–Ω–¥–∞—Ä—Ç –ß–∏–∂–∏–∫: –æ—Ç 390 –∫–≤.–º</small>
                    </div>
                    <div class="form-group">
                        <label for="maxArea">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å (–∫–≤.–º):</label>
                        <input type="number" id="maxArea" placeholder="–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π" min="390" max="50000">
                        <small style="color: #666;">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="maxPrice">–ú–∞–∫—Å. —Ü–µ–Ω–∞ (–º–ª–Ω —Ä—É–±):</label>
                        <input type="number" id="maxPrice" placeholder="–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π" min="1" max="1000" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="sortBy">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</label>
                        <select id="sortBy">
                            <option value="price_asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ü–µ–Ω—ã</option>
                            <option value="price_desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é —Ü–µ–Ω—ã</option>
                            <option value="area_asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –ø–ª–æ—â–∞–¥–∏</option>
                            <option value="area_desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é –ø–ª–æ—â–∞–¥–∏</option>
                            <option value="date_desc" selected>–ü–æ –¥–∞—Ç–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è</option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label>
                        <input type="checkbox" id="saleOnly" checked disabled> 
                        üè™ –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ –ü–†–û–î–ê–ñ–£ (–Ω–µ –∞—Ä–µ–Ω–¥–∞)
                    </label>
                </div>

                <div class="form-group full-width">
                    <label>
                        <input type="checkbox" id="demoMode" checked> 
                        üé≠ –î–µ–º–æ-—Ä–µ–∂–∏–º (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
                    </label>
                </div>

                <button onclick="searchListings()" class="primary" style="width: 100%; margin-top: 20px; font-size: 18px; padding: 16px;">
                    üîç –ù–∞–π—Ç–∏ –ø–æ–º–µ—â–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ–¥–∞–∂—É
                </button>
            </div>

            <div class="map-container">
                <h3>üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
                <div id="yandex-map"></div>
                <div id="map-status" style="text-align: center; margin-top: 10px; color: #666; font-size: 14px;">
                    –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã...
                </div>
            </div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let currentAccessToken = null;
        let yandexMap = null;

        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–µ–≥–∏–æ–Ω–æ–≤ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
        const CHIZHIK_REGIONS = {
            "all_regions": {"name": "–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã –†–æ—Å—Å–∏–∏", "coords": [55.7558, 37.6176], "zoom": 3},
            "moscow": {"name": "–ú–æ—Å–∫–≤–∞ –∏ –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 621540, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [55.7558, 37.6176]},
            "voronezh": {"name": "–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10661, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [51.6720, 39.1843]},
            "yaroslavl": {"name": "–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10687, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [57.6261, 39.8845]},
            "ivanovo": {"name": "–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10665, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [57.0000, 41.0000]},
            "vladimir": {"name": "–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10658, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [56.1366, 40.3966]},
            "tula": {"name": "–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10832, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [54.1961, 37.6182]},
            "tver": {"name": "–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10838, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [56.8587, 35.9176]},
            "ryazan": {"name": "–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10800, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [54.6269, 39.6916]},
            "kaluga": {"name": "–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10677, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [54.5293, 36.2754]},
            "belgorod": {"name": "–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10656, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è", "coords": [50.5950, 36.5870]},
            "saratov": {"name": "–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10819, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ", "coords": [51.5924, 46.0037]},
            "nizhny_novgorod": {"name": "–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10743, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ", "coords": [56.2965, 43.9361]},
            "kazan": {"name": "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω", "location_id": 10716, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ", "coords": [55.8304, 49.0661]},
            "samara": {"name": "–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10805, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ", "coords": [53.2001, 50.1500]},
            "volgograd": {"name": "–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10660, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ", "coords": [48.7080, 44.5133]},
            "ufa": {"name": "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω", "location_id": 10650, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ", "coords": [54.7388, 55.9721]},
            "penza": {"name": "–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10776, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ", "coords": [53.2007, 45.0000]},
            "orenburg": {"name": "–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10752, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ", "coords": [51.7727, 55.0988]},
            "chelyabinsk": {"name": "–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11225, "federal_district": "–£—Ä–∞–ª", "coords": [55.1644, 61.4368]},
            "ekaterinburg": {"name": "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11162, "federal_district": "–£—Ä–∞–ª", "coords": [56.8431, 60.6454]},
            "perm": {"name": "–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π", "location_id": 10779, "federal_district": "–£—Ä–∞–ª", "coords": [58.0105, 56.2502]},
            "kurgan": {"name": "–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11143, "federal_district": "–£—Ä–∞–ª", "coords": [55.4500, 65.3333]},
            "rostov": {"name": "–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10800, "federal_district": "–Æ–≥ –†–æ—Å—Å–∏–∏", "coords": [47.2357, 39.7015]},
            "krasnodar": {"name": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π", "location_id": 10995, "federal_district": "–Æ–≥ –†–æ—Å—Å–∏–∏", "coords": [45.0448, 38.9760]},
            "stavropol": {"name": "–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π", "location_id": 11069, "federal_district": "–Æ–≥ –†–æ—Å—Å–∏–∏", "coords": [45.0428, 41.9734]},
            "astrakhan": {"name": "–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10654, "federal_district": "–Æ–≥ –†–æ—Å—Å–∏–∏", "coords": [46.3497, 48.0408]},
            "novosibirsk": {"name": "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11316, "federal_district": "–°–∏–±–∏—Ä—å", "coords": [55.0084, 82.9357]},
            "kemerovo": {"name": "–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11282, "federal_district": "–°–∏–±–∏—Ä—å", "coords": [55.3331, 86.0833]},
            "omsk": {"name": "–û–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11318, "federal_district": "–°–∏–±–∏—Ä—å", "coords": [54.9885, 73.3242]},
            "tomsk": {"name": "–¢–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11322, "federal_district": "–°–∏–±–∏—Ä—å", "coords": [56.5000, 84.9667]},
            "spb": {"name": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –∏ –õ–û", "location_id": 10174, "federal_district": "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥", "coords": [59.9311, 30.3609]},
            "kaliningrad": {"name": "–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 22, "federal_district": "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥", "coords": [54.7065, 20.5110]},
            "arkhangelsk": {"name": "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10842, "federal_district": "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥", "coords": [64.5401, 40.5433]},
            "murmansk": {"name": "–ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10897, "federal_district": "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥", "coords": [68.9585, 33.0827]}
        };

        // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤
        const DEMO_LISTINGS = [
            {
                title: "–¢–æ—Ä–≥–æ–≤–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ 420 –∫–≤.–º –≤ —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã",
                price: { value: 45000000 },
                area: 420,
                address: "–≥. –ú–æ—Å–∫–≤–∞, –¶–ê–û, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è",
                description: "–û—Ç–¥–µ–ª—å–Ω–æ —Å—Ç–æ—è—â–µ–µ –∑–¥–∞–Ω–∏–µ, –ø–µ—Ä–≤—ã–π —ç—Ç–∞–∂, –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥, –º–µ—Å—Ç–æ –¥–ª—è —Ä–∞–∑–≥—Ä—É–∑–∫–∏",
                floor: "1",
                seller_type: "–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫",
                created_at: new Date().toISOString(),
                coordinates: { lat: 55.7558 + (Math.random() - 0.5) * 0.1, lon: 37.6176 + (Math.random() - 0.5) * 0.1 },
                url: "https://www.avito.ru/moskva/kommercheskaya_nedvizhimost/prodazha/pomeschenie-demo1"
            },
            {
                title: "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ 580 –∫–≤.–º –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ",
                price: { value: 38000000 },
                area: 580,
                address: "–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω",
                description: "–ü–æ–º–µ—â–µ–Ω–∏–µ –≤ —Ç–æ—Ä–≥–æ–≤–æ–º —Ü–µ–Ω—Ç—Ä–µ, –≤—ã—Å–æ–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫, –ø–∞—Ä–∫–æ–≤–∫–∞",
                floor: "1",
                seller_type: "–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ",
                created_at: new Date().toISOString(),
                coordinates: { lat: 59.9311 + (Math.random() - 0.5) * 0.1, lon: 30.3609 + (Math.random() - 0.5) * 0.1 },
                url: "https://www.avito.ru/sankt-peterburg/kommercheskaya_nedvizhimost/prodazha/pomeschenie-demo2"
            },
            {
                title: "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ-—Ç–æ—Ä–≥–æ–≤–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ 750 –∫–≤.–º –≤ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–µ",
                price: { value: 22000000 },
                area: 750,
                address: "–≥. –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, –û—Ä–¥–∂–æ–Ω–∏–∫–∏–¥–∑–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω",
                description: "–û—Ç–¥–µ–ª—å–Ω–æ —Å—Ç–æ—è—â–µ–µ –∑–¥–∞–Ω–∏–µ, —Å–∫–ª–∞–¥—Å–∫–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è, —É–¥–æ–±–Ω–∞—è –ª–æ–≥–∏—Å—Ç–∏–∫–∞",
                floor: "1",
                seller_type: "–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫",
                created_at: new Date().toISOString(),
                coordinates: { lat: 56.8431 + (Math.random() - 0.5) * 0.1, lon: 60.6454 + (Math.random() - 0.5) * 0.1 },
                url: "https://www.avito.ru/ekaterinburg/kommercheskaya_nedvizhimost/prodazha/pomeschenie-demo3"
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –Ø–Ω–¥–µ–∫—Å
        ymaps.ready(function () {
            try {
                yandexMap = new ymaps.Map('yandex-map', {
                    center: [55.751244, 37.618423], // –ú–æ—Å–∫–≤–∞
                    zoom: 5,
                    controls: ['zoomControl', 'fullscreenControl', 'geolocationControl']
                });

                document.getElementById('map-status').innerHTML = 
                    '<span style="color: #28a745;">‚úÖ –ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å API –∫–ª—é—á–æ–º</span>';

                console.log('Yandex Maps successfully initialized');
            } catch (error) {
                document.getElementById('map-status').innerHTML = 
                    '<span style="color: #dc3545;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã: ' + error.message + '</span>';
                console.error('Yandex Maps initialization error:', error);
            }
        });

        async function testHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                document.getElementById('results').innerHTML = 
                    '<div class="status success"><strong>‚úÖ Health Check —É—Å–ø–µ—à–µ–Ω:</strong><br><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ Health Check:</strong> ' + error.message + '</div>';
            }
        }

        async function testAuth() {
            try {
                document.getElementById('results').innerHTML = 
                    '<div class="status info"><strong>üîÑ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...</strong><br>–ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –æ—Ç –ê–≤–∏—Ç–æ API...</div>';

                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({grant_type: 'client_credentials'})
                });
                const data = await response.json();

                if (data.success && data.access_token) {
                    currentAccessToken = data.access_token;
                    document.getElementById('results').innerHTML = 
                        '<div class="status success"><strong>‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</strong><br>–¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω ' + 
                        Math.round(data.expires_in / 3600) + ' —á–∞—Å–æ–≤<br><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                } else {
                    document.getElementById('results').innerHTML = 
                        '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</strong><br><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                }
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:</strong> ' + error.message + '</div>';
            }
        }

        function testMap() {
            if (yandexMap) {
                // –û—á–∏—â–∞–µ–º –∫–∞—Ä—Ç—É
                yandexMap.geoObjects.removeAll();

                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –º–µ—Ç–∫—É
                const testPlacemark = new ymaps.Placemark([55.751244, 37.618423], {
                    balloonContent: '<strong>–¢–µ—Å—Ç–æ–≤–∞—è –º–µ—Ç–∫–∞</strong><br>API –∫–ª—é—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!<br>JavaScript API: a02e9c35-dadf-4b17-903a-4893c30c8b3e<br>Tiles API: 37d973f4-24d9-45f9-aef5-1745f7a13e1d'
                }, {
                    preset: 'islands#greenDotIcon'
                });

                yandexMap.geoObjects.add(testPlacemark);
                yandexMap.setCenter([55.751244, 37.618423], 10, { duration: 1000 });

                document.getElementById('results').innerHTML = 
                    '<div class="status success"><strong>‚úÖ –¢–µ—Å—Ç –∫–∞—Ä—Ç—ã —É—Å–ø–µ—à–µ–Ω!</strong><br>' +
                    '–ö–∞—Ä—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å API –∫–ª—é—á–∞–º–∏:<br>' +
                    'üó∫Ô∏è JavaScript API: a02e9c35-dadf-4b17-903a-4893c30c8b3e<br>' +
                    'üß© Tiles API: 37d973f4-24d9-45f9-aef5-1745f7a13e1d<br>' +
                    '–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –º–µ—Ç–∫–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã.</div>';
            } else {
                document.getElementById('results').innerHTML = 
                    '<div class="status error"><strong>‚ùå –ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!</strong><br>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏ –Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç.</div>';
            }
        }

        async function searchListings() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (!currentAccessToken) {
                document.getElementById('results').innerHTML = 
                    '<div class="status warning"><strong>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!</strong><br>–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏—Ç–µ "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ê–≤–∏—Ç–æ" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.</div>';
                return;
            }

            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
            const region = document.getElementById('region').value;
            const minArea = parseInt(document.getElementById('minArea').value) || 390;
            const maxArea = document.getElementById('maxArea').value ? parseInt(document.getElementById('maxArea').value) : null;
            const maxPrice = document.getElementById('maxPrice').value;
            const sortBy = document.getElementById('sortBy').value;
            const demoMode = document.getElementById('demoMode').checked;

            if (!region) {
                document.getElementById('results').innerHTML = 
                    '<div class="status warning"><strong>‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω!</strong></div>';
                return;
            }

            // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
            const filters = {
                min_area: minArea,
                max_area: maxArea,
                deal_type: "sale",
                sort_by: sortBy,
                demo_mode: demoMode,
                chizhik_requirements: {
                    single_level_preferred: true,
                    loading_zone_preferred: true,
                    utilities_required: true
                }
            };

            if (maxPrice) filters.max_price = parseFloat(maxPrice) * 1000000; // –º–ª–Ω –≤ —Ä—É–±–ª–∏

            // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–∏—Å–∫–∞
            const regionData = CHIZHIK_REGIONS[region];
            const regionName = regionData?.name || region;

            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ
            if (yandexMap && regionData && regionData.coords) {
                const zoom = region === 'all_regions' ? 3 : 9;
                yandexMap.setCenter(regionData.coords, zoom, { duration: 1000 });
            }

            document.getElementById('results').innerHTML = 
                '<div class="status info"><strong>üîç –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –Ω–∞ –ü–†–û–î–ê–ñ–£...</strong><br>' +
                '–†–µ–≥–∏–æ–Ω: ' + regionName + '<br>' +
                '–ü–ª–æ—â–∞–¥—å: –æ—Ç ' + minArea + (maxArea ? ' –¥–æ ' + maxArea : '') + ' –∫–≤.–º<br>' +
                '–¢–∏–ø —Å–¥–µ–ª–∫–∏: –ü–û–ö–£–ü–ö–ê –ø–æ–º–µ—â–µ–Ω–∏—è<br>' +
                '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: ' + document.getElementById('sortBy').selectedOptions[0].text + '<br>' +
                '–ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Avito API...</div>';

            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        region: region,
                        filters: filters,
                        access_token: currentAccessToken,
                        search_type: 'enhanced_sale_listings'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –≤–∫–ª—é—á–µ–Ω –¥–µ–º–æ-—Ä–µ–∂–∏–º
                    if (data.results.length === 0 && demoMode) {
                        data.results = getFilteredDemoListings(filters, region);
                        data.total_count = data.results.length;
                        data.demo_mode = true;
                    }

                    displaySearchResults(data);
                    updateMapWithResults(data.results);
                } else {
                    document.getElementById('results').innerHTML = 
                        '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:</strong><br><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                }
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:</strong> ' + error.message + '</div>';
            }
        }

        function getFilteredDemoListings(filters, region) {
            let listings = [...DEMO_LISTINGS];

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–ª–æ—â–∞–¥–∏
            if (filters.min_area) {
                listings = listings.filter(item => item.area >= filters.min_area);
            }
            if (filters.max_area) {
                listings = listings.filter(item => item.area <= filters.max_area);
            }

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ü–µ–Ω–µ
            if (filters.max_price) {
                listings = listings.filter(item => item.price.value <= filters.max_price);
            }

            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–≥–∏–æ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            if (region !== 'all_regions' && CHIZHIK_REGIONS[region]) {
                const regionCoords = CHIZHIK_REGIONS[region].coords;
                listings = listings.map(item => ({
                    ...item,
                    coordinates: {
                        lat: regionCoords[0] + (Math.random() - 0.5) * 0.1,
                        lon: regionCoords[1] + (Math.random() - 0.5) * 0.1
                    },
                    address: item.address.replace(/–≥\. \w+/, CHIZHIK_REGIONS[region].name)
                }));
            }

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            if (filters.sort_by) {
                switch (filters.sort_by) {
                    case 'price_asc':
                        listings.sort((a, b) => a.price.value - b.price.value);
                        break;
                    case 'price_desc':
                        listings.sort((a, b) => b.price.value - a.price.value);
                        break;
                    case 'area_asc':
                        listings.sort((a, b) => a.area - b.area);
                        break;
                    case 'area_desc':
                        listings.sort((a, b) => b.area - a.area);
                        break;
                    case 'date_desc':
                        listings.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                        break;
                }
            }

            return listings;
        }

        function displaySearchResults(data) {
            const demoNotice = data.demo_mode ? 
                '<div class="status warning"><strong>üé≠ –î–µ–º–æ-—Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω</strong><br>–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>' : '';

            const resultsHtml = `
                <div class="status success">
                    <strong>‚úÖ –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –Ω–∞ –ü–†–û–î–ê–ñ–£ –∑–∞–≤–µ—Ä—à–µ–Ω!</strong><br>
                    –ù–∞–π–¥–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π: <strong>${data.total_count}</strong> –≤ —Ä–µ–≥–∏–æ–Ω–µ <strong>${data.region}</strong><br>
                    –¢–∏–ø —Å–¥–µ–ª–∫–∏: <strong>–ü–†–û–î–ê–ñ–ê</strong> (–Ω–µ –∞—Ä–µ–Ω–¥–∞)<br>
                    –ü–ª–æ—â–∞–¥—å: –æ—Ç ${data.filters_applied?.min_area || 390}${data.filters_applied?.max_area ? ' –¥–æ ' + data.filters_applied.max_area : ''} –∫–≤.–º<br>
                    –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞: ${new Date(data.timestamp).toLocaleString('ru-RU')}
                </div>
                ${demoNotice}
                ${data.results.map(item => `
                    <div class="result-item" onclick="focusOnMap([${item.coordinates.lat}, ${item.coordinates.lon}])">
                        <div class="result-title">üè¢ ${item.title}</div>
                        <div class="result-price">üí∞ ${item.price.value.toLocaleString('ru-RU')} ‚ÇΩ (–ü–†–û–î–ê–ñ–ê)</div>
                        <div class="result-details">
                            üìç <strong>–ê–¥—Ä–µ—Å:</strong> ${item.address}<br>
                            üìê <strong>–ü–ª–æ—â–∞–¥—å:</strong> ${item.area} –∫–≤.–º<br>
                            üíµ <strong>–¶–µ–Ω–∞ –∑–∞ –∫–≤.–º:</strong> ${Math.round(item.price.value / item.area).toLocaleString('ru-RU')} ‚ÇΩ/–∫–≤.–º<br>
                            üè¢ <strong>–≠—Ç–∞–∂:</strong> ${item.floor || '–Ω–µ —É–∫–∞–∑–∞–Ω'}<br>
                            üö™ <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${item.description}<br>
                            üìÖ <strong>–†–∞–∑–º–µ—â–µ–Ω–æ:</strong> ${new Date(item.created_at).toLocaleDateString('ru-RU')}<br>
                            üë§ <strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> ${item.seller_type}<br>
                            üó∫Ô∏è <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> ${item.coordinates.lat.toFixed(4)}, ${item.coordinates.lon.toFixed(4)}
                        </div>
                        <a href="${item.url}" target="_blank" class="result-link" onclick="event.stopPropagation();">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –ê–≤–∏—Ç–æ ‚Üí
                        </a>
                    </div>
                `).join('')}
            `;

            document.getElementById('results').innerHTML = resultsHtml;
        }

        function updateMapWithResults(results) {
            if (!yandexMap || !results || results.length === 0) return;

            // –û—á–∏—â–∞–µ–º –∫–∞—Ä—Ç—É
            yandexMap.geoObjects.removeAll();

            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É
            results.forEach((item, index) => {
                const placemark = new ymaps.Placemark([item.coordinates.lat, item.coordinates.lon], {
                    balloonContent: `
                        <strong>${item.title}</strong><br>
                        <strong>–¶–µ–Ω–∞:</strong> ${item.price.value.toLocaleString('ru-RU')} ‚ÇΩ<br>
                        <strong>–ü–ª–æ—â–∞–¥—å:</strong> ${item.area} –∫–≤.–º<br>
                        <strong>–ê–¥—Ä–µ—Å:</strong> ${item.address}<br>
                        <a href="${item.url}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –ê–≤–∏—Ç–æ</a>
                    `
                }, {
                    preset: 'islands#redDotIcon'
                });

                yandexMap.geoObjects.add(placemark);
            });

            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
            if (results.length > 0) {
                yandexMap.setBounds(yandexMap.geoObjects.getBounds(), { checkZoomRange: true });
            }
        }

        function focusOnMap(coordinates) {
            if (yandexMap) {
                yandexMap.setCenter(coordinates, 15, { duration: 500 });
            }
        }

        // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('minArea').value = 390;
            document.getElementById('saleOnly').checked = true;
            document.getElementById('demoMode').checked = true;
        });
    </script>
</body>
</html>