<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∏–∂–∏–∫ - –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –Ω–∞ –ê–≤–∏—Ç–æ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 50%, #6ba368 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2d5016, #4a7c59, #6ba368);
        }
        .header {
            text-align: center;
            color: #2d5016;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
        }
        .header h1 {
            font-size: 2.8em;
            margin: 0;
            background: linear-gradient(45deg, #2d5016, #4a7c59, #6ba368);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }
        .header p {
            color: #666;
            font-size: 1.1em;
            margin-top: 10px;
        }
        .status {
            padding: 18px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid;
            font-weight: 500;
        }
        .success { 
            background-color: #d4edda; 
            color: #155724; 
            border-left-color: #28a745;
        }
        .info { 
            background-color: #d1ecf1; 
            color: #0c5460; 
            border-left-color: #17a2b8;
        }
        .warning { 
            background-color: #fff3cd; 
            color: #856404; 
            border-left-color: #ffc107;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            background: linear-gradient(45deg, #2d5016, #4a7c59);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px 5px;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(45, 80, 22, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        button:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(45, 80, 22, 0.4);
            background: linear-gradient(45deg, #4a7c59, #6ba368);
        }
        button:active {
            transform: translateY(-1px);
        }
        button.primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
        }
        button.primary:hover {
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
            background: linear-gradient(45deg, #0056b3, #004085);
        }

        /* –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ß–∏–∂–∏–∫ */
        .chizhik-requirements {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 2px solid #2d5016;
            position: relative;
        }
        .chizhik-requirements h3 {
            color: #2d5016;
            margin-top: 0;
            font-size: 1.3em;
            display: flex;
            align-items: center;
        }
        .chizhik-requirements ul {
            columns: 2;
            column-gap: 30px;
            list-style: none;
            padding: 0;
        }
        .chizhik-requirements li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
            break-inside: avoid;
        }
        .chizhik-requirements li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏ */
        .network-stats {
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #4a7c59;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2d5016;
        }
        .stat-label {
            font-size: 0.9em;
            color: #666;
        }

        /* –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ */
        .search-form {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            border: 2px solid #dee2e6;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .search-form h3 {
            color: #2d5016;
            margin-top: 0;
            font-size: 1.4em;
        }
        .form-group {
            margin: 20px 0;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 14px;
        }
        .form-group select, .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ced4da;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #2d5016;
            box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.1);
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .form-group.full-width {
            grid-column: 1 / -1;
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        #results {
            margin-top: 25px;
            padding: 25px;
            border-radius: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        .result-item {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            border-left: 5px solid #2d5016;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .result-title {
            font-weight: 700;
            color: #2d5016;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .result-details {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.6;
        }
        .result-price {
            font-weight: bold;
            color: #28a745;
            font-size: 18px;
            margin: 8px 0;
        }
        .result-link {
            display: inline-block;
            margin-top: 12px;
            padding: 8px 16px;
            background: linear-gradient(45deg, #2d5016, #4a7c59);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .result-link:hover {
            background: linear-gradient(45deg, #4a7c59, #6ba368);
            transform: translateY(-1px);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .chizhik-requirements ul {
                columns: 1;
            }
            .container {
                padding: 25px;
                margin: 10px;
            }
            .header h1 {
                font-size: 2.2em;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ –ß–∏–∂–∏–∫ - –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –Ω–∞ –ê–≤–∏—Ç–æ</h1>
            <p>–ü–æ–∏—Å–∫ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤–æ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Å–µ—Ç–∏</p>
        </div>

        <div class="status success">
            <strong>‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞!</strong><br>
            –í–µ—Ä—Å–∏—è: 4.0.0 | –°—Ç–∞—Ç—É—Å: –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Å–µ—Ç–∏ | –†–µ–≥–∏–æ–Ω–æ–≤: 19 | –ú–∞–≥–∞–∑–∏–Ω–æ–≤: 70+
        </div>

        <div class="network-stats">
            <h3 style="text-align: center; margin-top: 0; color: #2d5016;">üìä –ì–µ–æ–≥—Ä–∞—Ñ–∏—è —Å–µ—Ç–∏ "–ß–∏–∂–∏–∫"</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">19</div>
                    <div class="stat-label">–†–µ–≥–∏–æ–Ω–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">70+</div>
                    <div class="stat-label">–ú–∞–≥–∞–∑–∏–Ω–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">6</div>
                    <div class="stat-label">–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –æ–∫—Ä—É–≥–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">–ü–æ–∫—Ä—ã—Ç–∏–µ —Å–µ—Ç–∏</div>
                </div>
            </div>
        </div>

        <div class="chizhik-requirements">
            <h3>üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–µ—Ç–∏ "–ß–∏–∂–∏–∫" –∫ –ø–æ–º–µ—â–µ–Ω–∏—è–º:</h3>
            <ul>
                <li><strong>–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å:</strong> 390-420 –∫–≤.–º</li>
                <li><strong>–¢–æ—Ä–≥–æ–≤—ã–π –∑–∞–ª:</strong> 250-280 –∫–≤.–º</li>
                <li><strong>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ –≤ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ</li>
                <li><strong>–í—Ö–æ–¥:</strong> –Ω–∞–ª–∏—á–∏–µ –≤—Ö–æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã</li>
                <li><strong>–†–∞–∑–≥—Ä—É–∑–∫–∞:</strong> –∑–æ–Ω–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã–µ –ø—É—Ç–∏</li>
                <li><strong>–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ:</strong> 40-50 –∫–í—Ç</li>
                <li><strong>–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏:</strong> –≤–æ–¥–∞, –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è, –æ—Ç–æ–ø–ª–µ–Ω–∏–µ</li>
                <li><strong>–°—Ä–æ–∫ –∞—Ä–µ–Ω–¥—ã:</strong> –æ—Ç 7 –ª–µ—Ç (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 10+ –ª–µ—Ç)</li>
            </ul>
        </div>

        <h3>üîó API Endpoints:</h3>
        <ul>
            <li><strong>GET /api/health</strong> - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã</li>
            <li><strong>POST /api/auth</strong> - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ê–≤–∏—Ç–æ API</li>
            <li><strong>POST /api/search</strong> - –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π</li>
        </ul>

        <h3>üéõÔ∏è –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã:</h3>
        <button onclick="testHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Health</button>
        <button onclick="testAuth()" class="primary">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ê–≤–∏—Ç–æ</button>

        <div class="search-form">
            <h3>üîç –ü–æ–∏—Å–∫ –≤–æ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è "–ß–∏–∂–∏–∫":</h3>

            <div class="form-group">
                <label for="region">–†–µ–≥–∏–æ–Ω –ø–æ–∏—Å–∫–∞ (–≤—Å–µ —Ä–µ–≥–∏–æ–Ω—ã —Å –º–∞–≥–∞–∑–∏–Ω–∞–º–∏ –ß–∏–∂–∏–∫):</label>
                <select id="region" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Å–µ—Ç–∏...</option>
                    <optgroup label="üèõÔ∏è –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è (7 —Ä–µ–≥–∏–æ–Ω–æ–≤, 15+ –º–∞–≥–∞–∑–∏–Ω–æ–≤)">
                        <option value="moscow">–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (7 –º–∞–≥–∞–∑–∏–Ω–æ–≤)</option>
                        <option value="voronezh">–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (3 –º–∞–≥–∞–∑–∏–Ω–∞)</option>
                        <option value="yaroslavl">–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                        <option value="ivanovo">–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                    </optgroup>
                    <optgroup label="üåä –ü–æ–≤–æ–ª–∂—å–µ (5 —Ä–µ–≥–∏–æ–Ω–æ–≤, 10+ –º–∞–≥–∞–∑–∏–Ω–æ–≤)">
                        <option value="saratov">–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (4 –º–∞–≥–∞–∑–∏–Ω–∞)</option>
                        <option value="nizhny_novgorod">–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (2 –º–∞–≥–∞–∑–∏–Ω–∞)</option>
                        <option value="kazan">–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω (2 –º–∞–≥–∞–∑–∏–Ω–∞)</option>
                        <option value="ufa">–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                        <option value="penza">–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                    </optgroup>
                    <optgroup label="‚õ∞Ô∏è –£—Ä–∞–ª (3 —Ä–µ–≥–∏–æ–Ω–∞, 7+ –º–∞–≥–∞–∑–∏–Ω–æ–≤)">
                        <option value="chelyabinsk">–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (5 –º–∞–≥–∞–∑–∏–Ω–æ–≤)</option>
                        <option value="ekaterinburg">–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                        <option value="perm">–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                    </optgroup>
                    <optgroup label="‚òÄÔ∏è –Æ–≥ –†–æ—Å—Å–∏–∏ (3 —Ä–µ–≥–∏–æ–Ω–∞, 5+ –º–∞–≥–∞–∑–∏–Ω–æ–≤)">
                        <option value="rostov">–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (2 –º–∞–≥–∞–∑–∏–Ω–∞)</option>
                        <option value="krasnodar">–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π (2 –º–∞–≥–∞–∑–∏–Ω–∞)</option>
                        <option value="stavropol">–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                    </optgroup>
                    <optgroup label="‚ùÑÔ∏è –°–∏–±–∏—Ä—å (1 —Ä–µ–≥–∏–æ–Ω, 1+ –º–∞–≥–∞–∑–∏–Ω)">
                        <option value="kemerovo">–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                    </optgroup>
                    <optgroup label="üå≤ –°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥ (1 —Ä–µ–≥–∏–æ–Ω, 1+ –º–∞–≥–∞–∑–∏–Ω)">
                        <option value="kaliningrad">–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (1 –º–∞–≥–∞–∑–∏–Ω)</option>
                    </optgroup>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="minArea">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å (–∫–≤.–º):</label>
                    <input type="number" id="minArea" value="390" min="390" max="1000" required>
                    <small style="color: #666;">–°—Ç–∞–Ω–¥–∞—Ä—Ç –ß–∏–∂–∏–∫: –æ—Ç 390 –∫–≤.–º</small>
                </div>
                <div class="form-group">
                    <label for="maxArea">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å (–∫–≤.–º):</label>
                    <input type="number" id="maxArea" value="420" min="390" max="1000">
                    <small style="color: #666;">–°—Ç–∞–Ω–¥–∞—Ä—Ç –ß–∏–∂–∏–∫: –¥–æ 420 –∫–≤.–º</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="maxPrice">–ú–∞–∫—Å. —Ü–µ–Ω–∞ –∑–∞ –∫–≤.–º (—Ä—É–±/–º–µ—Å—è—Ü):</label>
                    <input type="number" id="maxPrice" placeholder="2500" min="500" max="10000">
                </div>
                <div class="form-group">
                    <label for="singleLevel">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                    <select id="singleLevel">
                        <option value="">–õ—é–±–æ–µ</option>
                        <option value="true" selected>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –æ–¥–Ω–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ</option>
                        <option value="false">–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –¥–æ–ø—É—Å—Ç–∏–º–æ</option>
                    </select>
                </div>
            </div>

            <div class="form-group full-width">
                <label>
                    <input type="checkbox" id="loadingZone" checked> 
                    –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: –∑–æ–Ω–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã–µ –ø—É—Ç–∏
                </label>
            </div>

            <button onclick="searchListings()" class="primary" style="width: 100%; margin-top: 20px; font-size: 18px; padding: 16px;">
                üîç –ù–∞–π—Ç–∏ –ø–æ–º–µ—â–µ–Ω–∏—è –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–µ—Ç–∏ –ß–∏–∂–∏–∫
            </button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let currentAccessToken = null;

        // –ü–æ–ª–Ω–∞—è –±–∞–∑–∞ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –ß–∏–∂–∏–∫
        const ALL_CHIZHIK_REGIONS = {"moscow": {"name": "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 621540, "priority": 1, "active_stores": 5, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è"}, "chelyabinsk": {"name": "–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11225, "priority": 2, "active_stores": 5, "federal_district": "–£—Ä–∞–ª"}, "saratov": {"name": "–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10819, "priority": 3, "active_stores": 4, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ"}, "voronezh": {"name": "–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10661, "priority": 4, "active_stores": 3, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è"}, "rostov": {"name": "–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10800, "priority": 5, "active_stores": 2, "federal_district": "–Æ–≥ –†–æ—Å—Å–∏–∏"}, "nizhny_novgorod": {"name": "–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10743, "priority": 6, "active_stores": 2, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ"}, "krasnodar": {"name": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π", "location_id": 10995, "priority": 7, "active_stores": 2, "federal_district": "–Æ–≥ –†–æ—Å—Å–∏–∏"}, "kazan": {"name": "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω", "location_id": 10716, "priority": 8, "active_stores": 2, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ"}, "yaroslavl": {"name": "–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10687, "priority": 9, "active_stores": 1, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è"}, "kaliningrad": {"name": "–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 22, "priority": 10, "active_stores": 1, "federal_district": "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥"}, "ivanovo": {"name": "–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10665, "priority": 11, "active_stores": 1, "federal_district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –†–æ—Å—Å–∏—è"}, "perm": {"name": "–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π", "location_id": 10779, "priority": 12, "active_stores": 1, "federal_district": "–£—Ä–∞–ª"}, "stavropol": {"name": "–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π", "location_id": 11069, "priority": 13, "active_stores": 1, "federal_district": "–Æ–≥ –†–æ—Å—Å–∏–∏"}, "adygea": {"name": "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ê–¥—ã–≥–µ—è", "location_id": 10649, "priority": 14, "active_stores": 1, "federal_district": "–Æ–≥ –†–æ—Å—Å–∏–∏"}, "ekaterinburg": {"name": "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 11162, "priority": 15, "active_stores": 1, "federal_district": "–£—Ä–∞–ª"}, "volgograd": {"name": "–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10660, "priority": 16, "active_stores": 1, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ"}, "ufa": {"name": "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω", "location_id": 10650, "priority": 17, "active_stores": 1, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ"}, "penza": {"name": "–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10776, "priority": 18, "active_stores": 1, "federal_district": "–ü–æ–≤–æ–ª–∂—å–µ"}, "kemerovo": {"name": "–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "location_id": 10716, "priority": 19, "active_stores": 1, "federal_district": "–°–∏–±–∏—Ä—å"}};

        async function testHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                document.getElementById('results').innerHTML = 
                    '<div class="status success"><strong>‚úÖ Health Check —É—Å–ø–µ—à–µ–Ω:</strong><br><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ Health Check:</strong> ' + error.message + '</div>';
            }
        }

        async function testAuth() {
            try {
                document.getElementById('results').innerHTML = 
                    '<div class="status info"><strong>üîÑ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...</strong><br>–ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –æ—Ç –ê–≤–∏—Ç–æ API...</div>';

                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({grant_type: 'client_credentials'})
                });
                const data = await response.json();

                if (data.success && data.access_token) {
                    currentAccessToken = data.access_token;
                    document.getElementById('results').innerHTML = 
                        '<div class="status success"><strong>‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</strong><br>–¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω ' + 
                        Math.round(data.expires_in / 3600) + ' —á–∞—Å–æ–≤<br><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                } else {
                    document.getElementById('results').innerHTML = 
                        '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</strong><br><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                }
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:</strong> ' + error.message + '</div>';
            }
        }

        async function searchListings() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (!currentAccessToken) {
                document.getElementById('results').innerHTML = 
                    '<div class="status warning"><strong>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!</strong><br>–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏—Ç–µ "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ê–≤–∏—Ç–æ" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.</div>';
                return;
            }

            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
            const region = document.getElementById('region').value;
            const minArea = parseInt(document.getElementById('minArea').value) || 390;
            const maxArea = parseInt(document.getElementById('maxArea').value) || 420;
            const maxPrice = document.getElementById('maxPrice').value;
            const singleLevel = document.getElementById('singleLevel').value;
            const loadingZone = document.getElementById('loadingZone').checked;

            if (!region) {
                document.getElementById('results').innerHTML = 
                    '<div class="status warning"><strong>‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Å–µ—Ç–∏!</strong></div>';
                return;
            }

            // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–¥ –ß–∏–∂–∏–∫
            const filters = {
                min_area: minArea,
                max_area: maxArea,
                chizhik_requirements: {
                    single_level: singleLevel === "true",
                    loading_zone: loadingZone,
                    utilities_required: true
                }
            };

            if (maxPrice) filters.max_price_per_sqm = parseInt(maxPrice);

            // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–∏—Å–∫–∞
            const regionData = ALL_CHIZHIK_REGIONS[region];
            const regionName = regionData?.name || region;
            const storeCount = regionData?.active_stores || 0;

            document.getElementById('results').innerHTML = 
                '<div class="status info"><strong>üîç –ü–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–µ—Ç–∏...</strong><br>' +
                '–†–µ–≥–∏–æ–Ω: ' + regionName + ' (' + storeCount + ' –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤)<br>' +
                '–ü–ª–æ—â–∞–¥—å: ' + minArea + '-' + maxArea + ' –∫–≤.–º<br>' +
                '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–≥–∏–æ–Ω–∞: ' + (regionData?.priority || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω') + '<br>' +
                '–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥: ' + (regionData?.federal_district || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω') + '<br>' +
                '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ Avito API...</div>';

            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        region: region,
                        filters: filters,
                        access_token: currentAccessToken,
                        search_type: 'chizhik_complete_network'
                    })
                });

                const data = await response.json();

                if (data.success && data.results) {
                    displaySearchResults(data);
                } else {
                    document.getElementById('results').innerHTML = 
                        '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:</strong><br><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                }
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="status error"><strong>‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:</strong> ' + error.message + '</div>';
            }
        }

        function displaySearchResults(data) {
            const resultsHtml = `
                <div class="status success">
                    <strong>‚úÖ –ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–µ—Ç–∏ –ß–∏–∂–∏–∫!</strong><br>
                    –ù–∞–π–¥–µ–Ω–æ –ø–æ–º–µ—â–µ–Ω–∏–π: <strong>${data.total_count}</strong> –≤ —Ä–µ–≥–∏–æ–Ω–µ <strong>${data.region}</strong><br>
                    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–≥–∏–æ–Ω–∞: <strong>${data.region_priority}</strong> (–∏–∑ ${data.network_info.total_regions} —Ä–µ–≥–∏–æ–Ω–æ–≤ —Å–µ—Ç–∏)<br>
                    –î–µ–π—Å—Ç–≤—É—é—â–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ –≤ —Ä–µ–≥–∏–æ–Ω–µ: <strong>${data.existing_stores}</strong><br>
                    –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: <strong>${data.network_info.expansion_potential}</strong><br>
                    –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º: –ø–ª–æ—â–∞–¥—å ${data.filters_applied.min_area || 390}-${data.filters_applied.max_area || 420} –∫–≤.–º<br>
                    –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞: ${new Date(data.timestamp).toLocaleString('ru-RU')}
                </div>
                ${data.results.map(item => `
                    <div class="result-item">
                        <div class="result-title">üè¢ ${item.title}</div>
                        <div class="result-price">üí∞ ${item.price.value.toLocaleString('ru-RU')} ‚ÇΩ/–º–µ—Å—è—Ü</div>
                        <div class="result-details">
                            üìç <strong>–ê–¥—Ä–µ—Å:</strong> ${item.location.name}<br>
                            üìê <strong>–ü–ª–æ—â–∞–¥—å:</strong> ${item.params.area} –∫–≤.–º 
                            ${item.chizhik_compliance.area_suitable ? '<span style="color: #28a745;">‚úì –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ß–∏–∂–∏–∫</span>' : '<span style="color: #dc3545;">‚ö† –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç</span>'}<br>
                            üíµ <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–≤.–º:</strong> ${Math.round(item.price.value / item.params.area).toLocaleString('ru-RU')} ‚ÇΩ/–∫–≤.–º<br>
                            üè¢ <strong>–≠—Ç–∞–∂:</strong> ${item.params.floor} | 
                            üö™ <strong>–í—Ö–æ–¥:</strong> ${item.params.entrance === 'separate' ? '‚úì –æ—Ç–¥–µ–ª—å–Ω—ã–π' : '‚ö† –æ–±—â–∏–π'}<br>
                            üöõ <strong>–ó–æ–Ω–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏:</strong> ${item.params.loading_zone ? '‚úÖ –µ—Å—Ç—å' : '‚ùå –Ω–µ—Ç'}<br>
                            ‚ö° <strong>–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ:</strong> ${item.params.electricity} –∫–í—Ç<br>
                            üè† <strong>–û–¥–Ω–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ:</strong> ${item.params.single_level ? '‚úÖ –¥–∞' : '‚ùå –Ω–µ—Ç'}<br>
                            üìä <strong>–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ß–∏–∂–∏–∫:</strong> ${item.chizhik_compliance.score}% (${item.chizhik_compliance.expansion_potential} –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª)<br>
                            üìÖ <strong>–†–∞–∑–º–µ—â–µ–Ω–æ:</strong> ${new Date(item.created_at).toLocaleDateString('ru-RU')}<br>
                            üë§ <strong>–ö–æ–Ω—Ç–∞–∫—Ç:</strong> ${item.seller.name} - ${item.seller.phone}
                        </div>
                        <a href="${item.url}" target="_blank" class="result-link">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –ê–≤–∏—Ç–æ ‚Üí
                        </a>
                    </div>
                `).join('')}
            `;

            document.getElementById('results').innerHTML = resultsHtml;
        }

        // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–¥ –ß–∏–∂–∏–∫
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('minArea').value = 390;
            document.getElementById('maxArea').value = 420;
            document.getElementById('loadingZone').checked = true;
            document.getElementById('singleLevel').value = 'true';
        });
    </script>
</body>
</html>